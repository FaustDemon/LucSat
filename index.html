<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Diamond Tap</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<style>
body {
  margin: 0;
  background: radial-gradient(circle at top, #0b0f1a, #000);
  color: #fff;
  font-family: Arial, sans-serif;
  display: flex;
  flex-direction: column;
  height: 100vh;
  touch-action: none;
  position: relative;
}
.top {
  margin-top: 20px;
  text-align: center;
  width: 100%;
  z-index: 2;
}
#level {
  font-size: 32px;
  font-weight: bold;
}
.progress-container {
  width: 80%;
  max-width: 300px;
  margin: 15px auto 0;
  background: #333;
  border-radius: 10px;
  overflow: hidden;
}
#progressBar {
  height: 12px;
  background: linear-gradient(90deg, #84fab0, #8fd3f4);
  width: 0%;
}
#progress {
  margin-top: 8px;
}
#timerContainer {
  position: absolute;
  top: 154px;
  width: 100%;
  text-align: center;
  display: none;
  pointer-events: none;
  z-index: 3;
}
#timer {
  font-family: 'Courier New', monospace;
  font-size: 56px;
  font-weight: bold;
  color: #8fd3f4;
  text-shadow: 0 0 10px rgba(143,211,244,0.5);
  animation: softBreathe 4s infinite ease-in-out;
}
#timer.urgent {
  color: #ff69b4;
  text-shadow: 0 0 15px rgba(255,105,180,0.7);
  animation: urgentBreathe 1.2s infinite ease-in-out;
}
@keyframes softBreathe {0%{opacity:0.9}50%{opacity:1}100%{opacity:0.9}}
@keyframes urgentBreathe {0%{opacity:0.95}50%{opacity:1}100%{opacity:0.95}}
.diamond-wrapper {flex:1; display:flex; align-items:center; justify-content:center; position:relative; width:100%;}
.diamond {width:120px; height:120px; background:linear-gradient(135deg, #8fd3f4, #84fab0); clip-path: polygon(50% 0%, 90% 25%, 100% 60%, 50% 100%, 0% 60%, 10% 25%); animation:breathe 3.8s ease-in-out infinite; transform: scale(var(--hit-scale,1)); transition: transform 0.12s;}
@keyframes breathe {0%{transform:scale(1);}50%{transform:scale(1.04);}100%{transform:scale(1);}}
.bottom {margin-bottom:80px; text-align:center;}
button {padding:14px 28px; font-size:18px; border-radius:12px; border:none; background:#1f6bff; color:#fff;}
button:disabled {background:#444;}
#menu {position: fixed; bottom: 0; width: 100%; display: flex; justify-content: space-around; background: rgba(0,0,0,0.8); padding:10px 0; z-index:10;}
.menu-btn {background: transparent; border:none; color:#fff; font-size:16px; cursor:pointer; padding:10px;}
.menu-btn.active {color:#8fd3f4; font-weight:bold;}
.section {display:none; flex:1; flex-direction:column; align-items:center; justify-content:flex-start; padding:20px; overflow-y:auto;}
#tapSection {display:flex;}
.card {background:#333; padding:15px; margin:10px 0; border-radius:10px; width:90%; max-width:350px;}
.card button {margin-top:10px; width:100%;}

/* --- –†–∞–∑–¥–µ–ª X: —Å–µ—Ç–∫–∞ --- */
#xSection {display:flex; flex-direction:column; align-items:center; justify-content:center; height:100%; overflow:hidden;}
.grid-container {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  grid-template-rows: repeat(6, 1fr);
  gap: 8px;
  width: 90%;
  max-width: 400px;
  height: calc(100% - 20px);
  margin-top: 0;
}
.grid-cell {
  background: linear-gradient(135deg,#84fab0,#8fd3f4);
  border-radius: 8px;
  aspect-ratio:1/1;
  display:flex;
  align-items:center;
  justify-content:center;
  font-weight:bold;
  color:#000;
  cursor:pointer;
  user-select:none;
  transition: transform 0.2s;
}
.grid-cell:hover {transform: scale(1.08);}
</style>
</head>
<body>

<div class="top">
  <div style="font-size:24px;margin-bottom:10px;">
    <span id="totalDiamonds">0.000</span> üíé
  </div>
  <div id="level">LEVEL 1</div>
  <div class="progress-container">
    <div id="progressBar"></div>
  </div>
  <div id="progress">0.000 / 100</div>
</div>

<div id="timerContainer">
  <div id="timer">00:05:00</div>
</div>

<!-- –°–µ–∫—Ü–∏–∏ -->
<div id="tapSection" class="section">
  <div class="diamond-wrapper">
    <div id="diamond" class="diamond"></div>
  </div>
  <div class="bottom">
    <button id="tapBtn">TAP</button>
  </div>
</div>

<div id="upgradeSection" class="section">
  <h2>–ü—Ä–æ–∫–∞—á–∫–∞</h2>
  <div class="card"><p>Coming Soon</p></div>
</div>

<div id="xSection" class="section">
  <div class="grid-container" id="xGrid">
    <!-- 24 —è—á–µ–π–∫–∏ -->
    <div class="grid-cell">1</div><div class="grid-cell">2</div><div class="grid-cell">3</div><div class="grid-cell">4</div>
    <div class="grid-cell">5</div><div class="grid-cell">6</div><div class="grid-cell">7</div><div class="grid-cell">8</div>
    <div class="grid-cell">9</div><div class="grid-cell">10</div><div class="grid-cell">11</div><div class="grid-cell">12</div>
    <div class="grid-cell">13</div><div class="grid-cell">14</div><div class="grid-cell">15</div><div class="grid-cell">16</div>
    <div class="grid-cell">17</div><div class="grid-cell">18</div><div class="grid-cell">19</div><div class="grid-cell">20</div>
    <div class="grid-cell">21</div><div class="grid-cell">22</div><div class="grid-cell">23</div><div class="grid-cell">24</div>
  </div>
</div>

<div id="farmSection" class="section">
  <h2>–§–∞—Ä–º –ö—Ä–∏—Å—Ç–∞–ª–ª–æ–≤</h2>
  <div class="card"><p>Coming Soon</p></div>
</div>

<div id="friendsSection" class="section">
  <h2>–î—Ä—É–∑—å—è</h2>
  <div class="card"><p>–ó–¥–µ—Å—å –±—É–¥—É—Ç –≤–∞—à–∏ –¥—Ä—É–∑—å—è</p>
    <button id="addFriend">–î–æ–±–∞–≤–∏—Ç—å –¥—Ä—É–≥–∞</button>
  </div>
</div>

<div id="menu">
  <button class="menu-btn active" data-section="tapSection">–¢–∞–ø</button>
  <button class="menu-btn" data-section="upgradeSection">–ü—Ä–æ–∫–∞—á–∫–∞</button>
  <button class="menu-btn" data-section="xSection">X</button>
  <button class="menu-btn" data-section="farmSection">–§–∞—Ä–º</button>
  <button class="menu-btn" data-section="friendsSection">–î—Ä—É–∑—å—è</button>
</div>

<script>
const CONFIG={tapValue:0.037,sessionDuration:5000,maxTouches:5,urgentThreshold:1000};
const tapBtn=document.getElementById('tapBtn');
const diamond=document.getElementById('diamond');
const totalDiamondsText=document.getElementById('totalDiamonds');
const levelText=document.getElementById('level');
const progressText=document.getElementById('progress');
const progressBar=document.getElementById('progressBar');
const timerContainer=document.getElementById('timerContainer');
const timer=document.getElementById('timer');

let totalDiamonds=parseFloat(localStorage.getItem('totalDiamonds'))||0;
let level=parseInt(localStorage.getItem('level'))||1;
let progress=parseFloat(localStorage.getItem('progress'))||0;
const diamondsPerLevel=100;

let active=false;
let startTime=0;
let timerInterval=null;
const activePointers=new Set();

function updateUI(){
  totalDiamondsText.innerText=totalDiamonds.toFixed(3);
  levelText.innerText=`LEVEL ${level}`;
  progressText.innerText=`${progress.toFixed(3)} / ${diamondsPerLevel}`;
  progressBar.style.width=`${(progress/diamondsPerLevel)*100}%`;
  localStorage.setItem('totalDiamonds',totalDiamonds);
  localStorage.setItem('level',level);
  localStorage.setItem('progress',progress);
}

updateUI();

document.querySelectorAll('.menu-btn').forEach(btn=>{
  btn.addEventListener('click',()=>{
    if(active)return;
    document.querySelectorAll('.section').forEach(s=>s.style.display='none');
    document.querySelectorAll('.menu-btn').forEach(b=>b.classList.remove('active'));
    const section=document.getElementById(btn.dataset.section);
    section.style.display='flex';
    btn.classList.add('active');
  });
});

function startSession(){
  if(active)return;
  active=true;
  tapBtn.disabled=true;
  timerContainer.style.display='block';
  timer.classList.remove('urgent');
  startTime=performance.now();
  timerInterval=setInterval(updateTimer,50);
  activePointers.clear();
}

function endSession(){
  active=false;
  tapBtn.disabled=false;
  timerContainer.style.display='none';
  activePointers.clear();
  diamond.style.setProperty('--hit-scale',1);
  clearInterval(timerInterval);
}

function updateTimer(){
  const remaining=Math.max(CONFIG.sessionDuration-(performance.now()-startTime),0);
  const s=Math.floor(remaining/1000);
  const ms=Math.floor((remaining%1000)/10);
  timer.innerText=`00:${s.toString().padStart(2,'0')}:${ms.toString().padStart(2,'0')}`;
  if(remaining<=CONFIG.urgentThreshold) timer.classList.add('urgent');
  if(remaining<=0) endSession();
}

document.body.addEventListener('pointerdown',e=>{
  if(!active)return;
  e.preventDefault();
  if(!activePointers.has(e.pointerId)){
    activePointers.add(e.pointerId);
    const effectiveTouches=Math.min(activePointers.size,CONFIG.maxTouches);
    const gain=CONFIG.tapValue*effectiveTouches;
    totalDiamonds+=gain;
    progress+=gain;
    if(progress>=diamondsPerLevel){progress-=diamondsPerLevel; level++;}
    diamond.style.setProperty('--hit-scale',1+effectiveTouches*0.06);
    updateUI();
  }
});

document.body.addEventListener('pointerup',e=>{
  activePointers.delete(e.pointerId);
  const effectiveTouches=Math.min(activePointers.size,CONFIG.maxTouches);
  diamond.style.setProperty('--hit-scale',1+effectiveTouches*0.06);
});

tapBtn.onclick=startSession;

// Telegram WebApp
if(window.Telegram&&Telegram.WebApp){
  const tg=Telegram.WebApp;
  tg.ready();
  tg.expand();
  tg.disableVerticalSwipes();
}
</script>

</body>
</html>

