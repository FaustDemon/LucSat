<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Diamond Tap</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<script src="https://telegram.org/js/telegram-web-app.js"></script>

<style>
body {
  margin: 0;
  background: radial-gradient(circle at top, #0b0f1a, #000);
  color: #fff;
  font-family: Arial, sans-serif;
  display: flex;
  flex-direction: column;
  height: 100vh;
  touch-action: none;
}

.top {
  margin-top: 20px;
  text-align: center;
  width: 100%;
  z-index: 2;
}

#level { font-size: 32px; font-weight: bold; }

.progress-container {
  width: 80%;
  max-width: 300px;
  margin: 15px auto 0;
  background: #333;
  border-radius: 10px;
  overflow: hidden;
}

#progressBar {
  height: 12px;
  background: linear-gradient(90deg, #84fab0, #8fd3f4);
  width: 0%;
}

#progress { margin-top: 8px; }

#timerContainer {
  position: absolute;
  top: 154px;
  width: 100%;
  text-align: center;
  display: none;
  pointer-events: none;
}

#timer {
  font-size: 56px;
  font-weight: bold;
  color: #8fd3f4;
}

.section {
  display: none;
  flex: 1;
  padding: 20px;
}

#tapSection { display: flex; flex-direction: column; }

.diamond-wrapper {
  flex: 1;
  display: flex;
  align-items: center;
  justify-content: center;
}

.diamond {
  width: 120px;
  height: 120px;
  background: linear-gradient(135deg, #8fd3f4, #84fab0);
  clip-path: polygon(50% 0%, 90% 25%, 100% 60%, 50% 100%, 0% 60%, 10% 25%);
}

.bottom { text-align: center; margin-bottom: 80px; }

button {
  padding: 14px 28px;
  border-radius: 12px;
  border: none;
  background: #1f6bff;
  color: #fff;
}

#menu {
  position: fixed;
  bottom: 0;
  width: 100%;
  display: flex;
  justify-content: space-around;
  background: rgba(0,0,0,0.8);
  padding: 10px 0;
}

.menu-btn {
  background: none;
  border: none;
  color: #fff;
  font-size: 16px;
}

.menu-btn.active { color: #8fd3f4; font-weight: bold; }

/* X section */
.merge-grid {
  display: grid;
  grid-template-columns: repeat(4, 64px);
  gap: 8px;
  justify-content: center;
}

.merge-cell {
  width: 64px;
  height: 64px;
  border: 1px solid #555;
  display: flex;
  align-items: center;
  justify-content: center;
  background: #222;
  cursor: pointer;
}

.merge-cell.locked {
  background: #111;
  cursor: not-allowed;
}
</style>
</head>

<body>

<div class="top">
  <div><span id="totalDiamonds">0.000</span> üíé</div>
  <div id="level">LEVEL 1</div>
  <div class="progress-container"><div id="progressBar"></div></div>
  <div id="progress">0 / 100</div>
</div>

<div id="timerContainer"><div id="timer">00:05:00</div></div>

<div id="tapSection" class="section">
  <div class="diamond-wrapper"><div id="diamond" class="diamond"></div></div>
  <div class="bottom"><button id="tapBtn">TAP</button></div>
</div>

<div id="upgradeSection" class="section"><h2>–ü—Ä–æ–∫–∞—á–∫–∞</h2><p>Coming soon</p></div>

<!-- X SECTION -->
<div id="xSection" class="section">
  <h2>X ‚Äî Merge</h2>
  <div id="energyX">–≠–Ω–µ—Ä–≥–∏—è: 30/30</div>
  <div class="merge-grid" id="mergeGrid"></div>
  <button id="dropX">–î—Ä–æ–ø (-5)</button>
  <button id="sellX">–ü—Ä–æ–¥–∞—Ç—å</button>
</div>

<div id="farmSection" class="section"><h2>–§–∞—Ä–º</h2><p>Coming soon</p></div>

<div id="menu">
  <button class="menu-btn active" data-section="tapSection">–¢–∞–ø</button>
  <button class="menu-btn" data-section="upgradeSection">–ü—Ä–æ–∫–∞—á–∫–∞</button>
  <button class="menu-btn" data-section="xSection">X</button>
  <button class="menu-btn" data-section="farmSection">–§–∞—Ä–º</button>
</div>

<script>
/* ====== –ú–ï–ù–Æ ====== */
document.querySelectorAll('.menu-btn').forEach(btn=>{
  btn.onclick=()=>{
    document.querySelectorAll('.menu-btn').forEach(b=>b.classList.remove('active'));
    document.querySelectorAll('.section').forEach(s=>s.style.display='none');
    btn.classList.add('active');
    document.getElementById(btn.dataset.section).style.display='flex';
  }
});
document.getElementById('tapSection').style.display='flex';

/* ====== X MERGE LOGIC ====== */
const grid=document.getElementById('mergeGrid');
const energyText=document.getElementById('energyX');
let energy=30,maxEnergy=30;
let cells=[],selected=null;

for(let i=0;i<24;i++){
  const c=document.createElement('div');
  c.className='merge-cell'+(i>=12?' locked':'');
  c.dataset.level=0;
  c.dataset.locked=i>=12;
  grid.appendChild(c);
  cells.push(c);

  c.onclick=()=>{
    if(c.dataset.locked==='true'||c.dataset.level==0)return;
    if(!selected){selected=c;c.style.border='2px solid #8fd3f4';}
    else if(selected!==c&&selected.dataset.level===c.dataset.level){
      c.dataset.level++;
      selected.dataset.level=0;
      selected.style.border='1px solid #555';
      selected=null;
      updateGrid();
    }
  };
}

function updateGrid(){
  cells.forEach(c=>{
    c.textContent=c.dataset.level>0?c.dataset.level:'';
  });
  energyText.textContent=`–≠–Ω–µ—Ä–≥–∏—è: ${energy}/${maxEnergy}`;
}

document.getElementById('dropX').onclick=()=>{
  if(energy<5)return;
  const empty=cells.filter(c=>c.dataset.level==0&&c.dataset.locked==='false');
  if(!empty.length)return;
  energy-=5;
  empty[Math.floor(Math.random()*empty.length)].dataset.level=1;
  updateGrid();
};

document.getElementById('sellX').onclick=()=>{
  if(!selected)return;
  energy+=Number(selected.dataset.level);
  selected.dataset.level=0;
  selected.style.border='1px solid #555';
  selected=null;
  updateGrid();
};

updateGrid();

const tg=window.Telegram.WebApp;
tg.ready();tg.expand();
</script>

</body>
</html>

